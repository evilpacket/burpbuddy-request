var rc = require('rc');
var config = rc('requiresafe', {
    token: ''
});
var commands = require('./commands');
var SDK = require('requiresafe-sdk');

var aliases = {
    'ls': 'list',
    'l': 'list',
    'h': 'help'
};

var proxy = process.env.https_proxy || process.env.HTTPS_PROXY || process.env.http_proxy || process.env.HTTP_PROXY;

// The main CLI method, accepts the command arguments and a callback
exports.run = function (callback) {
    // did the user specify a command?
    var passedCommand = config._[0];

    // figure out what the command was
    // default to `commands.help` if 
    // not passed or not found
    var command = passedCommand && commands[passedCommand] || commands[aliases[passedCommand]];

    if (!command) {
        command = commands.help;
    }

    config.api = new SDK({
        authToken: config.token,
        local: config.hasOwnProperty('local'),
        proxy: proxy
    });

    // Run the requested command
    command(config, callback);
};
