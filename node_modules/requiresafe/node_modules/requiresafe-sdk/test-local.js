var fs = require('fs');
var SDK = require('./rs-sdk');
var sdk = new SDK({
    baseUrl: 'http://localhost:3001/api/v1',
    acceptType: 'application/json'
});

sdk.signup({
    name: 'Philip',
    email: 'phil+client2@latentflip.com',
    password: 'MyPassword'
}, console.log.bind(console));

sdk.login('phil+client2@latentflip.com', 'MyPassword', function () {
    sdk.validateToken(console.log);
    sdk.me(console.log);
});

var badPackage = fs.readFileSync(__dirname + '/fixtures/bad-project.json');
var goodPackage = fs.readFileSync(__dirname + '/fixtures/good-project.json');

sdk.checkDependencies(JSON.parse(badPackage), function (err, res) {
    if (err) {
        console.error(err);
    } else {
        console.log('');
        console.log('Vulnerabilities found in fixtures/bad-project.json:');
        console.log(res.text);
    }
});

sdk.checkDependencies(JSON.parse(goodPackage), function (err, res) {
    if (err) {
        console.error(err);
    } else {
        console.log('');
        console.log('Vulnerabilities found in fixtures/good-project.json:');
        console.log(res.text);
    }
});
